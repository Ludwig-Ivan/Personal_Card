---
import Layout from "../layouts/Layout.astro";
import Cabezera from "../components/Cabezera.astro";
import Vinilo from "../components/Vinilo.astro";
import { vinilos_img, vinilos_music, recursos_extra } from "../js/links.js";

const {
    nirvana_logo,
    oasis_logo,
    chica_paranormal_logo,
    do_i_wanna_know_logo,
    let_i_happen_logo,
    tobe_nwigwe_logo,
    two_feet_logo,
    redbone_logo,
    tokio_drift_logo,
    the_neighbourhood_logo,
} = vinilos_img;

const {
    nirvana_mp3,
    oasis_mp3,
    chica_paranormal_mp3,
    do_i_wanna_know_mp3,
    let_i_happen_mp3,
    tobe_nwigwe_mp3,
    two_feet_mp3,
    redbone_mp3,
    tokio_drift_mp3,
    the_neighbourhood_mp3,
} = vinilos_music;

const { play_img, pause_img, forward_img, backward_img } = recursos_extra;
---

<Layout title="Musica">
    <main>
        <Cabezera />
        <div class="contenido">
            <div class="pila_vinilos">
                <Vinilo img={nirvana_logo} song={nirvana_mp3} clase="uno" />
                <Vinilo img={oasis_logo} song={oasis_mp3} clase="dos" />
                <Vinilo
                    img={chica_paranormal_logo}
                    song={chica_paranormal_mp3}
                    clase="tres"
                />
                <Vinilo
                    img={do_i_wanna_know_logo}
                    song={do_i_wanna_know_mp3}
                    clase="cuatro"
                />
                <Vinilo
                    img={let_i_happen_logo}
                    song={let_i_happen_mp3}
                    clase="cinco"
                />
                <Vinilo
                    img={tobe_nwigwe_logo}
                    song={tobe_nwigwe_mp3}
                    clase="seis"
                />
                <Vinilo img={two_feet_logo} song={two_feet_mp3} clase="siete" />
                <Vinilo img={redbone_logo} song={redbone_mp3} clase="ocho" />
                <Vinilo
                    img={tokio_drift_logo}
                    song={tokio_drift_mp3}
                    clase="nueve"
                />
                <Vinilo
                    img={the_neighbourhood_logo}
                    song={the_neighbourhood_mp3}
                    clase="diez"
                />
            </div>
            <div id="song_name"></div>
            <div class="opc_rep">
                <img
                    class="opc"
                    id="backward"
                    src={backward_img}
                    alt="anterior"
                />
                <img class="opc" id="play/pause" src={play_img} alt="p/p" />
                <img class="opc" id="forward" src={forward_img} alt="despues" />
            </div>
        </div>
    </main>
    <script>
        const backward = document.getElementById("backward");
        const forward = document.getElementById("forward");
        const play_pause = document.getElementById("play/pause");
        const title = document.getElementById("song_name");
        let song_name = [
            "Smells Like Teen Spirit - Nirvana",
            "La Cancion - Bad Bunny, J Balvin",
            "Chica Paranormal - Paulo Londra",
            "Do I Wanna Know - Artic Monkey",
            "Let It Happen - Tame Impala",
            "Lil Fish, Big Pond - Tobe Nwigwe",
            "Love Is a Bitch - Two Feet",
            "Redbone - Childish Gambino",
            "Six Days - Tokyo Drift",
            "Daddy Issues - The Neighbourhood",
        ];
        let cont = 0;
        title.innerText = song_name[cont];

        let ban = false;
        let vinilo = document.getElementsByClassName("vinilo")[0];
        let play_btn = document.getElementById("play/pause");
        let audio = document
            .querySelector(".contenedor_vinilo")
            .querySelector(".vinilo")
            .querySelector("audio");

        //Funcion encargada del reacomodo de clases
        function Reacomodo() {
            let vinilos = document.querySelectorAll(".contenedor_vinilo");
            for (let index = 0; index < vinilos.length; index++) {
                vinilos[index].className =
                    "contenedor_vinilo " +
                    [
                        "uno",
                        "dos",
                        "tres",
                        "cuatro",
                        "cinco",
                        "seis",
                        "siete",
                        "ocho",
                        "nueve",
                        "diez",
                    ][index];
            }
        }

        //Funcion encargada del cambio de clase siguiente
        const Cambio_Next = () => {
            let vinilos = document.querySelectorAll(".contenedor_vinilo");
            let vinilo_act = [...vinilos];
            let pila_vinilos = document.querySelector(".pila_vinilos");

            pila_vinilos.removeChild;

            vinilo_act.push(vinilo_act.shift());

            vinilo_act.forEach((vinilo) => {
                pila_vinilos.appendChild(vinilo);
            });

            Reacomodo();
        };

        //Funcion encargada del cambio de clase anterior
        const Cambio_Back = () => {
            let vinilos = document.querySelectorAll(".contenedor_vinilo");
            let vinilo_act = [...vinilos];
            let pila_vinilos = document.querySelector(".pila_vinilos");

            pila_vinilos.removeChild;

            vinilo_act.unshift(vinilo_act.pop());

            vinilo_act.forEach((vinilo) => {
                pila_vinilos.appendChild(vinilo);
            });

            Reacomodo();
        };

        //Evento encargado de pausar o activar la cancion
        play_pause.addEventListener("click", () => {
            vinilo = document.querySelector(".contenedor_vinilo");
            if (!ban) {
                play_btn.src = "../icons/pause.png";
                vinilo.querySelector(".vinilo").querySelector("audio").play();
                ban = true;
            } else {
                play_btn.src = "../icons/play.png";
                vinilo.querySelector(".vinilo").querySelector("audio").pause();
                ban = false;
            }
            audio = document
                .querySelector(".contenedor_vinilo")
                .querySelector(".vinilo")
                .querySelector("audio");

            audio.addEventListener("ended", () => {
                console.log("cambio");
                play_btn.src = "../icons/play.png";

                //Lanzo el evento click para forward
                const next = new Event("click");
                forward.dispatchEvent(next);
            });
        });
        //Evento encargado de retroceder a la anterior cancion
        forward.addEventListener("click", () => {
            if (cont < 9) {
                const vinilo_animated =
                    document.querySelector(".contenedor_vinilo");
                vinilo_animated.style.visibility = "hidden";

                cont++;
                title.innerText = song_name[cont];
                if (!vinilo.getElementsByTagName("audio")[0].paused)
                    vinilo.getElementsByTagName("audio")[0].pause();
                play_btn.src = "../icons/play.png";
                ban = false;

                Cambio_Next();

                const play = new Event("click");
                play_pause.dispatchEvent(play);
            }
        });
        //Evento encargado de pasar a la siguiente cancion
        backward.addEventListener("click", () => {
            if (cont > 0) {
                cont--;
                title.innerText = song_name[cont];
                if (!vinilo.getElementsByTagName("audio")[0].paused)
                    vinilo.getElementsByTagName("audio")[0].pause();
                play_btn.src = "../public/icons/play.png";
                ban = false;
                Cambio_Back();
                const play = new Event("click");
                play_pause.dispatchEvent(play);
            }

            const vinilo_animated =
                document.querySelector(".contenedor_vinilo");
            vinilo_animated.style.visibility = "visible";
        });
    </script>
</Layout>

<style>
    .contenido {
        height: 90vh;
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
    }

    main {
        background-color: #181818;
    }

    .pila_vinilos {
        position: relative;
        height: 400px;
        width: 400px;
        margin-right: 15vh;
    }

    .opc_rep {
        display: flex;
        gap: 10vh;
    }

    .opc {
        height: 70px;
        width: 70px;
        transition-duration: 0.5s;
    }

    .opc:hover {
        transition-duration: 0.5s;
        transform: scale(1.2);
    }

    #song_name {
        font-size: 20px;
        color: #f2f2f2;
        font-weight: 900;
    }
</style>
